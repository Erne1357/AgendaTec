{% extends "layouts/base.html" %}
{% block title %}Mi carrera{% endblock %}
{% block content %}
<h1 class="h5 mb-3">Selecciona tu carrera</h1>
<select id="selProgram" class="form-select">
  <option value="">Selecciona...</option>
</select>
<div id="coordCard" class="card mt-3 d-none">
  <div class="card-body">
    <h5 class="card-title" id="coordName"></h5>
    <p class="mb-1"><strong>Correo:</strong> <span id="coordEmail"></span></p>
    <p class="mb-0"><strong>Horario:</strong> <span id="coordHours"></span></p>
  </div>
</div>
{% endblock %}
{% block body_extra %}
<script>
(async function loadPrograms(){
  const r = await fetch('/api/v1/programs', {credentials:'include'});
  const data = await r.json();
  const sel = document.getElementById('selProgram');
  sel.innerHTML = '<option value="">Selecciona...</option>' + 
    data.items.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
})();
document.getElementById('selProgram').addEventListener('change', async (e) => {
  const pid = e.target.value;
  const card = document.getElementById('coordCard');
  if(!pid){ card.classList.add('d-none'); return; }
  const r = await fetch(`/api/v1/programs/${pid}/coordinator`, {credentials:'include'});
  const data = await r.json();
  const c = (data.coordinators||[])[0];
  if(c){
    document.getElementById('coordName').textContent  = c.full_name;
    document.getElementById('coordEmail').textContent = c.email || 'N/D';
    document.getElementById('coordHours').textContent = c.office_hours || 'N/D';
    card.classList.remove('d-none');
    window.showToast && showToast('Coordinador cargado','success');
  }else{
    card.classList.add('d-none');
    window.showToast && showToast('Programa sin coordinador','warning');
  }
});
</script>
{% endblock %}
